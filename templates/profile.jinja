{% extends "base.jinja" %}

{% block title %}Profil{% endblock %}

{% block content %}
<div class="container mx-auto mt-5 p-4 rounded"
     style="max-width: 600px; background-color:beige">
    {% if utilisateur.image %}
        <div class="text-center mb-3">
            <img src="{{ url_for('static', filename=utilisateur.image) }}"

                 alt="Avatar" class="rounded-circle"
                 style="width: 150px; height: 150px; object-fit: cover; border: 3px solid darkgreen;">
        </div>
    {% endif %}

    <h1 class="titre text-center mb-3" style="color:darkgreen">{{ utilisateur.user_name }}</h1>
    <p class="text-center">{{ utilisateur.courriel }}</p>
    <p><strong>Description :</strong> {{ utilisateur.description or "Aucune description" }}</p>
    {% if utilisateur.est_coach %}
                <span class="badge bg-success">Coach</span>
    {% endif %}
    <div class="text-center mt-4">
    <a class="btn btn-warning d-inline-block me-2"
       href="{{ url_for('compte.profile_modif') }}">
       Modifier le profil
    </a>
    <form id="form-suppression" class="d-inline-block">
    <button type="submit" class="btn btn-danger">Supprimer mon compte</button>
</form>

<script>
document.getElementById("form-suppression").addEventListener("submit", async function (e) {
    e.preventDefault();

    const urlCheck = "{{ url_for('compte.verifier_suppression_profil') }}";
    const urlDelete = "{{ url_for('compte.supprimer_utilisateur') }}";

    const response = await fetch(urlCheck, {
        method: "POST",
        headers: { "Content-Type": "application/json" }
    });

    const data = await response.json();

    if (!data.ok) {
        alert(data.message || "Impossible de supprimer ce compte.");
        return;
    }

    if (!confirm("Confirmer la suppression de votre compte ?")) {
        return;
    }

    const deleteResponse = await fetch(urlDelete, {
        method: "POST"
    });

    if (deleteResponse.redirected) {
        window.location.href = deleteResponse.url;
    }
});
</script>

</div>
{% endblock %}
